<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Potato Smacker</title>
  <link rel="icon"
    href="https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato-icon64.png"
    type="image/png">
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    h1 {
      margin-bottom: 20px;
    }

    .potato-container {
      position: relative;
      display: inline-block;
      cursor: pointer;
      transition: transform 0.05s ease;
    }

    .potato {
      width: 350px;
      height: 350px;
      /* background: url('https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato-quilt.png') center/cover; */
    }

    .counter {
      margin-top: 10px;
      font-size: 1.5rem;
      color: #887766;
      text-align: center;
    }

    .link-list {
      margin-top: 20px;
      list-style: none;
      padding: 0;
    }

    .link-list li {
      margin: 5px 0;
    }

    .link-list a {
      color: #887766;
      text-decoration: none;
    }

    .link-list a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <h1>Don't Smack the Potato</h1>
  <div class="counter" id="counter">The potato is resting soundly. It wouldn't be right to disturb it.</div>

  <div class="potato-container" id="potato">
    <div class="potato"></div>
  </div>

  <ul class="link-list">
    <li><i><a href="#">"don't fall for its smackalicious crunchiness"</a></i></li>
  </ul>

  <script>
    /* --------------------  AUDIO ENGINE  -------------------- */
    let audioCtx;
    let smackBuffer, dingBuffer;
    const smackURL = "https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/smack.mp3";
    const dingURL = "https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/ding.mp3";

    async function fetchAndDecode(url) {
      const res = await fetch(url);
      const arr = await res.arrayBuffer();
      return await audioCtx.decodeAudioData(arr);
    }

    function playBuffer(buffer) {
      if (!audioCtx || !buffer) return;
      const src = audioCtx.createBufferSource();
      src.buffer = buffer;
      src.connect(audioCtx.destination);
      src.start();
    }

    /* --------------------  GAME LOGIC  -------------------- */
    let counter = -2;
    let previous_integral_part = 0;
    let dialogue_prefix_text = "";
    let prefix_text_list_history = [];
    let rotationDirection = 1; // alternates +1/-1

    const potato = document.getElementById("potato");
    potato.style.backgroundImage = "url('https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato-quilt.png')";
    potato.style.backgroundSize = "cover";

    // âœ… Fully mobile-safe audio init + resume
    potato.addEventListener("pointerdown", async () => {
      try {
        // Create or resume AudioContext inside user gesture
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          console.log("AudioContext created");
        }
        if (audioCtx.state === "suspended") {
          await audioCtx.resume();
          console.log("AudioContext resumed");
        }

        // Lazy-load buffers on first gesture (after context runs)
        if (!smackBuffer || !dingBuffer) {
          smackBuffer = await fetchAndDecode(smackURL);
          dingBuffer = await fetchAndDecode(dingURL);
          console.log("Audio decoded and ready");
        }

        // document.getElementsByTagName("h1")[0].textContent = "Don't Smack the Potato (sound on)"

        incrementCounter();
      } catch (err) {
        console.error("Audio init error:", err);

        // document.getElementsByTagName("h1")[0].textContent = "Don't Smack the Potato (sound off)"
      }
    }, { passive: true });

    function incrementCounter() {
      counter++;
      const counter_text = counter === 1
        ? "You Smacked the Potato!"
        : `You Smacked the Potato ${counter} times!`;

      const prefix_text_list = [
        "My Goodness! ",
        "Are you still at this? ",
        "Holy Cow! ",
        "You know you can stop right? ",
        "Unbelievable! ",
        "Seriously? Still?? ",
        "Goddamnit! ",
        "This is a violation! ",
        "Is this a cry for help? ",
        "Why? ",
        "You're really committed to this, huh? ",
        "I have no words anymore. ",
        "Somebody call a therapist! ",
        "This has gone too far! ",
        "Who hurt you? ",
        "Blink twice if you need help! ",
        "I wonder who the real Potato is! ",
        "Your dedication is... disturbing! ",
        "Stop it! Get some help. ",
        "Therapy is always an option, you know? ",
        "Don't you have a hobby? ",
        "Oh great, now the FBI is watching. ",
        "This is not how you win friends and influence people. ",
        "The Potato is reconsidering its existence. ",
        "If stupidity were an Olympic sport, you'd be the coach. ",
        "Please explain this to your future self. ",
        "You are one screen refresh away from wiping your progress. ",
        "The Potato is filing a grievance. ",
        "The Potato didn't consent to this. ",
        "This would be impressive if it wasn't concerning. ",
        "What would your ancestors say? ",
      ];

      const current_integral_part = Math.floor(counter / 25);
      if (current_integral_part !== previous_integral_part) {
        previous_integral_part = current_integral_part;
        do {
          dialogue_prefix_text = prefix_text_list[Math.floor(Math.random() * prefix_text_list.length)];
        } while (prefix_text_list_history.includes(dialogue_prefix_text) && prefix_text_list_history.length < prefix_text_list.length);
        prefix_text_list_history.push(dialogue_prefix_text);
        if (prefix_text_list_history.length > 5) prefix_text_list_history.shift();
        playBuffer(dingBuffer);
      }

      if (counter <= -2) {
          document.getElementById('potato').style.backgroundImage = "url('https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato-quilt.png')";
          document.getElementById('potato').style.backgroundSize = "cover";
          document.getElementById('counter').textContent =
          "The potato is resting soundly. It wouldn't be right to disturb it.";
      }
      else if (counter == -1) {
          document.getElementById('potato').style.backgroundImage = "url('https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato-bandaid.png')";
          document.getElementById('potato').style.backgroundSize = "cover";
          document.getElementById('counter').textContent =
          "Look at it all bandaged up. You wouldn't want to remove it would you?";
      }
      else if (counter == 0) {
          document.getElementById('potato').style.backgroundImage = "url('https://raw.githubusercontent.com/shashwat-r-weblab/shashwat-r-weblab.github.io/refs/heads/main/potato-smacker/potato.png')";
          document.getElementById('potato').style.backgroundSize = "cover";
          document.getElementById('counter').textContent =
          "Careful now, however tempted you are, Do Not Smack the Potato";
      }
      else if (counter >= 1) {
        document.getElementById('counter').textContent =
          dialogue_prefix_text + counter_text;

        playBuffer(smackBuffer);
        animatePotato();
      }
    }

    function animatePotato() {
      const potatoElem = document.querySelector('.potato-container');
      rotationDirection *= -1;
      const rotation = rotationDirection * 5;
      potatoElem.style.transition = 'transform 0.05s ease';
      potatoElem.style.transform = `scale(1.1) rotate(${rotation}deg)`;
      setTimeout(() => {
        potatoElem.style.transform = `scale(1.0) rotate(0deg)`;
      }, 150);
    }
  </script>
</body>

</html>
